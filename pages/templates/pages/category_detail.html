{% extends "base.html" %}
{% load static %}

{% block title %}{{ meta_title }}{% endblock %}
{% block meta %}
  {% if meta_description %}<meta name="description" content="{{ meta_description }}">{% endif %}
  {% if category.og_image %}<meta property="og:image" content="{{ category.og_image.url }}">{% endif %}
{% endblock %}

{% block content %}

{# HERO ХЕДЕР: большой, под прозрачное меню #}
<section class="relative h-[75vh] min-h-[520px] overflow-hidden">
  {% if category.header_image %}
    <img src="{{ category.header_image.url }}" alt="{{ category.title }}"
         class="absolute inset-0 w-full h-full object-cover scale-105">
  {% elif category.image %}
    <img src="{{ category.image.url }}" alt="{{ category.title }}"
         class="absolute inset-0 w-full h-full object-cover scale-105">
  {% endif %}

  <div class="absolute inset-0 bg-gradient-to-b from-black/70 via-black/40 to-black/70"></div>

  <div class="relative z-10 max-w-7xl mx-auto px-6 h-full flex items-end pb-16">
    <div class="text-white">
      <nav class="text-sm text-white/70">
        <a href="/catalog/" class="hover:text-white">Каталог</a>
        <span class="mx-2">/</span>
        <span class="text-white">{{ category.title }}</span>
      </nav>

      <h1 class="mt-2 text-4xl md:text-6xl font-black tracking-tight drop-shadow-[0_2px_10px_rgba(0,0,0,0.5)]">
        {{ category.header_title|default:category.title }}
      </h1>

      {% if category.header_subtitle %}
        <p class="mt-3 max-w-2xl text-white/85 text-lg leading-relaxed">
          {{ category.header_subtitle }}
        </p>
      {% endif %}

      <div class="mt-6 flex items-center gap-3">
        <a href="#photos"
           class="inline-flex items-center gap-2 px-6 py-3 rounded-xl font-semibold
                  bg-emerald-500 hover:bg-emerald-400 text-white
                  shadow-[0_8px_30px_rgba(16,185,129,0.35)] active:scale-[.98] transition">
          Смотреть работы
          <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 12h14m-7-7l7 7-7 7"/></svg>
        </a>
        <button type="button" class="js-open-measure inline-flex items-center h-11 px-5 rounded-xl
                                    bg-white/10 hover:bg-white/20 border border-white/20 backdrop-blur
                                    font-semibold">
          Пригласить замерщика
        </button>
      </div>
    </div>
  </div>
</section>

{# ОПИСАНИЕ #}
{% if category.description %}
<section class="bg-white">
  <div class="max-w-7xl mx-auto px-6 py-10">
    <div class="prose prose-slate max-w-none">
      {{ category.description|linebreaks }}
    </div>
  </div>
</section>
{% endif %}

{# ФОТОГАЛЕРЕЯ #}
<section id="photos" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
  {% if photos %}
    <div
      class="masonry grid grid-cols-2 md:grid-cols-4 lg:grid-cols-4
             gap-3 md:gap-4
             [grid-auto-flow:dense]
             auto-rows-[42vw]   /* мобилки: квадраты (2 колонки) */
             md:auto-rows-[220px]  /* планшеты */
             lg:auto-rows-[280px]">

      {% for p in photos %}
        <a href="{{ p.image.url }}"
           data-gallery="cat-{{ category.slug }}"
           {% if p.title %} data-title="{{ p.title|escape }}" {% endif %}
           class="glightbox relative group overflow-hidden rounded-2xl shadow-sm hover:shadow-lg transition
                  <!-- растяжения только с md и выше -->
                  {% if p.size == 'wide' %} md:col-span-2 {% elif p.size == 'tall' %} md:row-span-2 {% endif %}">
          <img src="{{ p.image.url }}" alt="{{ p.title }}"
               class="w-full h-full object-cover transition-transform duration-700 ease-out group-hover:scale-110" />
          <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-black/25 to-transparent
                      opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
          {% if p.title %}
            <div class="absolute left-3 right-3 bottom-3 text-white opacity-0 translate-y-2
                        group-hover:opacity-100 group-hover:translate-y-0 transition duration-300">
              <div class="text-sm md:text-base font-semibold drop-shadow-md leading-tight">{{ p.title }}</div>
            </div>
          {% endif %}
        </a>
      {% endfor %}
    </div>
  {% else %}
    <div class="text-slate-500 text-center py-16">Фотографии в этой категории пока не добавлены.</div>
  {% endif %}
</section>

{% endblock %}
